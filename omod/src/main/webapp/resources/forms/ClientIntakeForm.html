<htmlform formEncounterType="254574ff-2daf-4552-ba47-ca1636ddffa6" formName="Client intake form" formUuid="35cc381b-3b8f-45fa-b9b1-f638d51ad774" formVersion="1.0">
    <macros>
        paperFormId = (Fill this in)t headerColor =#2f1c55 fontOnHeaderColor = white
        @ARTSTARTDATE@ = art.start.date
    </macros>
    <style>
        .section {
            border: 1px solid $headerColor;
            padding: 2px;
            text-align: left;
            margin-bottom: 1em;
        }

        .sectionHeader {
            background-color: #2f1c55;
            color: white;
            /* display: block; */
            padding: 2px;
            font-weight: bold;
        }

        table tr:nth-child(even) {
            background: #ffffff;
        }

        .alnright {
            text-align: right;
            color: #000000;
            width: 25%;
        }

        .alnright_s {
            text-align: right;
            color: #000000;
            width: 13%;
        }

        .alnleft_s {
            text-align: left;
            color: #000000;
            width: 13%;
        }

        .alnleft_f {
            text-align: left;
            color: #000000;
            width: 20%;
        }

        .alnleft {
            text-align: left;
            color: #000000;
            width: 25%;
        }

        .error {
            color: red;
        }

        td {
            border: none;
        }

        table th,
        table td {
            padding: 5px 10px;
            border: None;
        }

        .legend_style {
            max-width: 35%;
            background: #FAFAFA;
        <!--padding: 5px;
        -->margin: 0px left;
            box-shadow: 1px 1px 25px rgba(0, 0, 0, 0.10);
            border-radius: 2px;
            border: 1px solid #305a72;
            border-bottom-left-radius: 2px;
            text-transform: initial;
        }

        form fieldset,
        .form fieldset {
            min-width: 98%;
            border: none;
            border-top: 1px solid #305a72;
        }

        table th,
        table td {
            padding: 5px 10px;
            /* border: 1px solid #DDD; */
        }

        table tr {
            border: None;
        }

        ul.select,
        .form input,
        .form select,
        .form textarea,
        .form ul.select {
            padding: 2px 10px;
        }

        form input,
        form select,
        form textarea,
        form ul.select,
        .form input,
        .form select,
        .form textarea,
        .form ul.select {
            padding: 2px 10px;
        }

        form select,
        .form select {
            max-width: 200px;
            min-width: 150px;
        }

        .standard {
            max-width: 200px;
            min-width: 150px;
        }

        body {
            font-family: "OpenSans", Arial, sans-serif;
            color: #363463;
            font-size: 14px;
        }
    </style>


    <script type="text/javascript">


        var $ = jQuery;
        var $j = jQuery;

        var path = $(location).attr('pathname').split('/')[1];
        var baseUrl = '/' + path + '/nigeriaemr/PatientIdTypeSetter';

        $(document).ready(function() {

            $('.hasDatepicker').attr('readonly', true)

            $.ajax({
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                url: baseUrl + "/getIdentifier.action",
                data: {
                    patientId: $('input[name=personId]').val(),
                    identifierType: $('#pref_type').val()
                },
                cache: false,
                timeout: 600000,
                success: function(r) {
                    if (r.code > 0) {
                        if (r.identifier.length > 0) {
                            if (r.preferred === true) {
                                //$('#preferred').prop("checked", 'checked');
                            }
                        }
                    }
                },
                error: function(e) {
                    console.log("ERROR : ", e);
                }
            });


            $('#preferred').click(function(e) {
                var patientIdentifier = $('input:text', '#identifer-td').eq(0).val();
                if (patientIdentifier) {
                    if (patientIdentifier.trim().length > 0) {
                        var obj = e.target;
                        var isPreferred = false;
                        if ($(obj).prop("checked") == true) {
                            isPreferred = true;
                        }

                        var patientId = $('input[name=personId]').val();
                        var identifierType = $('#pref_type').val();

                        var pid = {
                            patientId: patientId,
                            patientIdentifier: patientIdentifier,
                            identifierType: identifierType,
                            isPreferred: isPreferred
                        };
                        var link = baseUrl + "/setPidType.action";

                        $.ajax({
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            url: link,
                            data: pid,
                            cache: false,
                            timeout: 600000,
                            success: function(r) {
                                if (r.code !== 5) {
                                    alert(r.message);
                                }
                            },
                            error: function(e) {
                                console.log("ERROR : ", e);
                            }
                        });
                    } else {
                        $('#preferred').prop("checked", '');
                        alert('Please fill in the Client Code before setting as preferred');
                    }
                } else {
                    $('#preferred').prop("checked", '');
                    alert('Please fill in the Client Code before setting as preferred');
                }
            });
        });


        var get_risk_ever_had_sex = 0;
        var get_risk_blood_trans_3_months = 0;
        var get_risk_unprotected_sex_casual = 0;
        var get_risk_unprotected_sex_regular = 0;
        var get_risk_sti_last_3_months = 0;
        var get_risk_more_than_one_sex_partner = 0;
        var total_risk_val = 0;


        $j(function() {

            jQuery('#get_total_risk_val').find("input").attr("disabled", true);

            if (getField('risk_ever_had_sex.value') != null) {
                getField('risk_ever_had_sex.value').change(function() {
                    if (getValue('risk_ever_had_sex.value') == "1065") {
                        get_risk_ever_had_sex = 1;
                    } else {
                        get_risk_ever_had_sex = 0;
                    }
                    sum_risk_func();
                });
            }

            if (getField('risk_unprotected_sex_casual.value') != null) {
                getField('risk_unprotected_sex_casual.value').change(function() {
                    if (getValue('risk_unprotected_sex_casual.value') == "1065") {
                        get_risk_unprotected_sex_casual = 1;
                    } else {
                        get_risk_unprotected_sex_casual = 0;
                    }
                    sum_risk_func();
                });
            }

            if (getField('risk_blood_trans_3_months.value') != null) {
                getField('risk_blood_trans_3_months.value').change(function() {
                    if (getValue('risk_blood_trans_3_months.value') == "true") {
                        get_risk_blood_trans_3_months = 1;
                    } else {
                        get_risk_blood_trans_3_months = 0;
                    }
                    sum_risk_func();
                    console.log(getValue('risk_blood_trans_3_months.value'));
                });
            }



            if (getField('risk_unprotected_sex_regular.value') != null) {
                getField('risk_unprotected_sex_regular.value').change(function() {
                    if (getValue('risk_unprotected_sex_regular.value') == "1065") {
                        get_risk_unprotected_sex_regular = 1;
                    } else {
                        get_risk_unprotected_sex_regular = 0;
                    }
                    sum_risk_func();
                });
            }
            if (getField('risk_sti_last_3_months.value') != null) {
                getField('risk_sti_last_3_months.value').change(function() {
                    if (getValue('risk_sti_last_3_months.value') == "1065") {
                        get_risk_sti_last_3_months = 1;
                    } else {
                        get_risk_sti_last_3_months = 0;
                    }
                    sum_risk_func();
                });
            }

            if (getField('risk_more_than_one_sex_partner.value') != null) {
                getField('risk_more_than_one_sex_partner.value').change(function() {
                    if (getValue('risk_more_than_one_sex_partner.value') == "1065") {
                        get_risk_more_than_one_sex_partner = 1;
                    } else {
                        get_risk_more_than_one_sex_partner = 0;
                    }
                    sum_risk_func();
                });
            }



        });




        function sum_risk_func() {
            total_risk_val = (get_risk_more_than_one_sex_partner + get_risk_sti_last_3_months + get_risk_unprotected_sex_regular + get_risk_unprotected_sex_casual + get_risk_blood_trans_3_months + get_risk_ever_had_sex);

            // console.log(total_risk_val);
            setValue('get_total_risk_val.value', total_risk_val);
        }


        var get_complaint_vaginal_discharge = 0;
        var get_complaint_lowwer_abdominal_pain = 0;
        var get_complaint_genital_sore = 0;
        var get_urethral_discharge = 0;
        var get_scrotal_swelling = 0;
        var total_sti_val = 0;


        $j(function() {

            jQuery('#get_total_sti_val').find("input").attr("disabled", true);

            if (getField('complaint_vaginal_discharge.value') != null) {
                getField('complaint_vaginal_discharge.value').change(function() {

                    var val = getValue('complaint_vaginal_discharge.value');
                    if (val == "1065") {
                        get_complaint_vaginal_discharge = 1;
                    } else {
                        get_complaint_vaginal_discharge = 0;
                    }
                    sum_sti_func();
                });
            }


            if (getField('complaint_lowwer_abdominal_pain.value') != null) {
                getField('complaint_lowwer_abdominal_pain.value').change(function() {
                    if (getValue('complaint_lowwer_abdominal_pain.value') == "1065") {
                        get_complaint_lowwer_abdominal_pain = 1;
                    } else {
                        get_complaint_lowwer_abdominal_pain = 0;
                    }
                    sum_sti_func();
                });
            }


            if (getField('complaint_genital_sore.value') != null) {
                getField('complaint_genital_sore.value').change(function() {
                    if (getValue('complaint_genital_sore.value') == "1065") {
                        get_complaint_genital_sore = 1;
                    } else {
                        get_complaint_genital_sore = 0;
                    }
                    sum_sti_func();
                });
            }


            if (getField('urethral_discharge.value') != null) {
                getField('urethral_discharge.value').change(function() {
                    if (getValue('urethral_discharge.value') == "1065") {
                        get_urethral_discharge = 1;
                    } else {
                        get_urethral_discharge = 0;
                    }
                    sum_sti_func();
                });
            }

            if (getField('scrotal_swelling.value') != null) {
                getField('scrotal_swelling.value').change(function() {
                    if (getValue('scrotal_swelling.value') == "1065") {
                        get_scrotal_swelling = 1;
                    } else {
                        get_scrotal_swelling = 0;
                    }
                    sum_sti_func();
                });
            }




        });


        function sum_sti_func() {
            total_sti_val = (get_scrotal_swelling + get_urethral_discharge + get_complaint_genital_sore + get_complaint_lowwer_abdominal_pain + get_complaint_vaginal_discharge);

            setValue('get_total_sti_val.value', total_sti_val);
            if (total_sti_val >= 1) {
                $j('#sti_action_message').text('follow syndromic STI management guidelines or refer');
            } else {
                $j('#sti_action_message').text('');
            }
        }


        var get_tb_current_cough = 0;
        var get_tb_weight_loss = 0;
        var get_tb_fever = 0;
        var get_tb_night_sweats = 0;
        var get_contact_with_TB = 0;
        var get_total_tb_val = 0;




        $j(function() {

            jQuery('#get_total_tb_val').find("input").attr("disabled", true);

            if (getField('tb_current_cough.value') != null) {
                getField('tb_current_cough.value').change(function() {
                    if (getValue('tb_current_cough.value') == "1065") {
                        get_tb_current_cough = 1;
                    } else {
                        get_tb_current_cough = 0;
                    }
                    sum_tb_func();
                });
            }

            if (getField('tb_weight_loss.value') != null) {
                getField('tb_weight_loss.value').change(function() {
                    if (getValue('tb_weight_loss.value') == "true") {
                        get_tb_weight_loss = 1;
                    } else {
                        get_tb_weight_loss = 0;
                    }
                    sum_tb_func();
                });
            }


            if (getField('tb_fever.value') != null) {
                getField('tb_fever.value').change(function() {
                    if (getValue('tb_fever.value') == "1065") {
                        get_tb_fever = 1;
                    } else {
                        get_tb_fever = 0;
                    }
                    sum_tb_func();
                });
            }

            if (getField('tb_night_sweats.value') != null) {
                getField('tb_night_sweats.value').change(function() {
                    if (getValue('tb_night_sweats.value') == "true") {
                        get_tb_night_sweats = 1;
                    } else {
                        get_tb_night_sweats = 0;
                    }
                    sum_tb_func();
                });
            }


            if (getField('contact_with_TB.value') != null) {
                getField('contact_with_TB.value').change(function() {
                    if (getValue('contact_with_TB.value') == "1065") {
                        get_contact_with_TB = 1;
                    } else {
                        get_contact_with_TB = 0;
                    }
                    sum_tb_func();
                });
            }


        })


        function sum_tb_func() {
            total_tb_val = (get_contact_with_TB + get_tb_night_sweats + get_tb_fever + get_tb_weight_loss + get_tb_current_cough);

            setValue('get_total_tb_val.value', total_tb_val);
            if (total_tb_val >= 1) {
                $j('#tb_action_message').text('test for sputum AFB or refer to TB service');
            } else {
                $j('#tb_action_message').text('');
            }
        }


        $j(function() {

            if (getField('screen_test_value.value') != null) {
                getField('screen_test_value.value').change(function() {
                    if (getValue('screen_test_value.value') == "1229") {
                        $j('#tie_test').hide();
                        $j('#tie_test_date').hide();
                        $j('#tie_test_label').hide();
                    }
                });
            }


        });

        /*
        $j(function(){
        if(getField('rapid.value') != null){
        getField('rapid.value').change(function(){
        if(getValue('rapid.value')=="165851"){
        setValue('final_recency_test.value',"165851")
        }
        });
        }
        });
        */

        /*
        $j(function(){
            $j('#setting_name_pitc').hide();
            $j('#setting_pitc').hide();
            $j('#setting_vtc').hide();
            if($j('#kind_of_hts') != null){
                $j('#kind_of_hts').change(function(){
                    if($j('#kind_of_hts').val() == "Voluntary"){
                        console.log("This is voluntary");
                        $j('#setting_vtc').show();
                        $j('#setting_name_vtc').show();
                        $j('#setting_name_pitc').hide();
                        $j('#setting_pitc').hide();
                    }else if($j('#kind_of_hts').val() == "PITC") {
                        console.log("This is pitc");
                        $j('#setting_name_pitc').show();
                        $j('#setting_pitc').show();
                        $j('#setting_vtc').hide();
                        $j('#setting_name_vtc').hide();
                    }
                });
            }
        });
        */

        $j(function() {
            $j('#no_wives_label').hide();
            $j('#no_wives').hide();
            $j('#recency').hide();
        });
    </script>


    <script type="text/javascript">
        var $ = jQuery;
        var $j = jQuery;

        var path = $(location).attr('pathname').split('/')[1];
        var baseUrl = '/' + path + '/nigeriaemr/PatientIdTypeSetter';

        $(document).ready(function() {

            $.ajax({
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                url: baseUrl + "/getIdentifier.action",
                data: {
                    patientId: $('input[name=personId]').val(),
                    identifierType: 10
                },
                cache: false,
                timeout: 600000,
                success: function(r) {
                    if (r.code > 0) {
                        if (r.identifier.length > 0) {
                            if (r.preferred === true) {
                                //$('#preferred_recency').prop("checked", 'checked');
                            }
                        }
                    }
                },
                error: function(e) {
                    console.log("ERROR : ", e);
                }
            });


            $('#preferred_recency').click(function(e) {
                var patientIdentifier_recency = $('input:text', '#recency_number_value').eq(0).val();
                if (patientIdentifier_recency) {
                    if (patientIdentifier_recency.trim().length > 0) {
                        var obj = e.target;
                        var isPreferred = false;
                        if ($(obj).prop("checked") == true) {
                            isPreferred = true;
                        }

                        var patientId = $('input[name=personId]').val();
                        var identifierType = $('#pref_type_recency').val();

                        var pid = {
                            patientId: patientId,
                            patientIdentifier: patientIdentifier_recency,
                            identifierType: 10,
                            isPreferred: isPreferred
                        };
                        var link = baseUrl + "/setPidType.action";

                        $.ajax({
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            url: link,
                            data: pid,
                            cache: false,
                            timeout: 600000,
                            success: function(r) {
                                if (r.code !== 5) {
                                    alert(r.message);
                                }
                            },
                            error: function(e) {
                                console.log("ERROR : ", e);
                            }
                        });
                    } else {
                        $('#preferred_recency').prop("checked", '');
                        alert('Please fill in the Participant ID before setting as preferred');
                    }
                } else {
                    $('#preferred_recency').prop("checked", '');
                    alert('Please fill in the Participant ID before setting as preferred');
                }
            });
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('date_of_visit.value') != null) {
                getField('date_of_visit.value').change(function() {

                    var today = new Date();
                    var visitDate = new Date(getValue('date_of_visit.value'));

                    if (visitDate > today) {
                        const field = getField('date_of_visit.error');
                        if (field != null) {
                            getField('date_of_visit.error').html('Visit date cannot be a future date').show();
                        }
                    }


                });
            }
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('hiv_test_date.value') != null) {
                getField('hiv_test_date.value').change(function() {

                    var today = new Date();
                    var visitDate = new Date(getValue('date_of_visit.value'));
                    var testVal = new Date(getValue('hiv_test_date.value'));
                    console.log("Encounter Date", visitDate)
                    if (testVal > today) {
                        const field = getField('hiv_test_date.error');
                        if (field != null) {
                            getField('hiv_test_date.error').html('Screening test date cannot be a future date').show();
                        }
                    }

                    if (visitDate > testVal) {
                        const field = getField('hiv_test_date.error');
                        if (field != null) {
                            getField('hiv_test_date.error').html('Screening test date cannot be earlier than Visit Date').show();
                        }
                    }


                });
            }
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('confirm_test_date.value') != null) {
                getField('confirm_test_date.value').change(function() {

                    var today = new Date();
                    var testVal = new Date(getValue('hiv_test_date.value'));
                    var confirmVal = new Date(getValue('confirm_test_date.value'));

                    if (confirmVal > today) {
                        const field = getField('confirm_test_date.error');
                        if (field != null) {
                            getField('confirm_test_date.error').html('Confirmatory test date cannot be a future date').show();
                        }
                    }

                    if (testVal > confirmVal) {
                        const field = getField('confirm_test_date.error');
                        if (field != null) {
                            getField('confirm_test_date.error').html('Confirmatory test date cannot be earlier than Screening Test Date').show();
                        }
                    }


                });
            }
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('tie_test_date.value') != null) {
                getField('tie_test_date.value').change(function() {

                    var today = new Date();
                    var confirmVal = new Date(getValue('confirm_test_date.value'));
                    var tieVal = new Date(getValue('tie_test_date.value'));

                    if (tieVal > today) {
                        const field = getField('tie_test_date.error');
                        if (field != null) {
                            getField('tie_test_date.error').html('Tie breaker test date cannot be a future date').show();
                        }
                    }

                    if (confirmVal > tieVal) {
                        const field = getField('tie_test_date.error');
                        if (field != null) {
                            getField('tie_test_date.error').html('Tie breaker test date cannot be earlier than Confirmatory Test Date').show();
                        }
                    }


                });
            }
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('recency_test_date.value') != null) {
                getField('recency_test_date.value').change(function() {

                    var today = new Date();
                    var testVal = new Date(getValue('hiv_test_date.value'));
                    var rctd = new Date(getValue('recency_test_date.value'));

                    if (rctd > today) {
                        const field = getField('recency_test_date.error');
                        if (field != null) {
                            getField('recency_test_date.error').html('Recency Test Date cannot be a future date').show();
                        }
                    }

                    if (testVal > rctd) {
                        const field = getField('recency_test_date.error');
                        if (field != null) {
                            getField('recency_test_date.error').html('Recency Test Date cannot be earlier than Screening Test Date').show();
                        }

                    }


                });
            }
        });
    </script>

    <script>
        jQuery(function() {
            $("#vl_result_obs").on("input", function() {

                var vlresultT = getValue('vl_result_clasification.value');
                var vlresultobs = getValue('vl_result_obs.value');
                if (vlresultT === "166239") {
                    if (vlresultobs &lt; 1000) {

                        const field = getField('vl_result_obs.error');
                        if (field != null) {
                            getField('vl_result_obs.error').html('Result (copies/ml) cannot be less than 1000 if Viral Load Result Classification is greater than 1000').show();
                        }
                    }

                }

                if (vlresultT === "166238") {

                    if (vlresultobs >= 1000)

                    {
                        const field = getField('vl_result_obs.error');
                        if (field != null) {
                            getField('vl_result_obs.error').html('Result (copies/ml) cannot be  1000 or greater if Viral Load Result Classification is less than 1000').show();
                        }

                    }

                }

                if (vlresultT == "166240") {

                    if (vlresultobs != "")

                    {
                        const field = getField('vl_result_obs.error');
                        if (field != null) {
                            getField('vl_result_obs.error').html('Result (copies/ml) should be empty if Viral Load Result Classification is Failed VL').show();
                        }

                    }

                }


            });
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('vlsample_value_obs.value') != null) {
                getField('vlsample_value_obs.value').change(function() {

                    var today = new Date();
                    var vlsamplev = new Date(getValue('vlsample_value_obs.value'));
                    var rctd = new Date(getValue('recency_test_date.value'));

                    if (vlsamplev > today) {
                        const field = getField('vlsample_value_obs.error');
                        if (field != null) {
                            getField('vlsample_value_obs.error').html('Sample collection Date cannot be a future date').show();
                        }
                    }

                    if (rctd > vlsamplev) {
                        const field = getField('vlsample_value_obs.error');
                        if (field != null) {
                            getField('vlsample_value_obs.error').html('Sample collection Date cannot be earlier than Recency Test Date').show();
                        }
                    }


                });
            }
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('vlpcr_value_obs.value') != null) {
                getField('vlpcr_value_obs.value').change(function() {

                    var today = new Date();
                    var vlsamplev = new Date(getValue('vlsample_value_obs.value'));
                    var vlpcr = new Date(getValue('vlpcr_value_obs.value'));

                    if (vlpcr > today) {
                        const field = getField('vlpcr_value_obs.error');
                        if (field != null) {
                            getField('vlpcr_value_obs.error').html('Date Sample Sent to PCR Lab cannot be a future date').show();
                        }
                    }

                    if (vlsamplev > vlpcr) {
                        const field = getField('vlpcr_value_obs.error');
                        if (field != null) {
                            getField('vlpcr_value_obs.error').html('Date Sample Sent to PCR Lab cannot be earlier than Sample collection Date').show();
                        }
                    }


                });
            }
        });
    </script>


    <script>
        jQuery(function() {
            if (getField('vl_value_obs.value') != null) {
                getField('vl_value_obs.value').change(function() {

                    var today = new Date();
                    var vlvalue = new Date(getValue('vl_value_obs.value'));
                    var vlpcr = new Date(getValue('vlpcr_value_obs.value'));

                    if (vlvalue > today) {
                        const field = getField('vl_value_obs.error');
                        if (field != null) {
                            getField('vl_value_obs.error').html('Sample Test Date cannot be a future date').show();
                        }
                    }

                    if (vlpcr > vlvalue) {
                        const field = getField('vl_value_obs.error');
                        if (field != null) {
                            getField('vl_value_obs.error').html('Sample Test Date cannot be earlier than Date Sample Sent to PCR Lab').show();
                        }
                    }


                });
            }
        });
    </script>



    <script>
        jQuery(function() {
            if (getField('screen_test_value.value') != null) {
                getField('screen_test_value.value').change(function() {

                    $('#result').hide();
                    var scntest = getValue('screen_test_value.value');

                    if (scntest == "1229") {
                        $('#result').show();
                        setValue('result.value', 664);
                        $('#result').attr("style", "pointer-events: none;");
                    }


                });
            }
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('confirm_test_value.value') != null) {
                getField('confirm_test_value.value').change(function() {

                    $('#result').hide();
                    var cfmtest = getValue('confirm_test_value.value');
                    var scntest = getValue('screen_test_value.value');
                    if (scntest == "1228") {
                        if (cfmtest == "1228") {
                            $('#result').show();
                            setValue('result.value', 703);
                            $('#result').attr("style", "pointer-events: none;");
                            //$('#recency').show();
                        } else {
                            $('#result').show();
                            setValue('result.value', 664);
                            $('#result').attr("style", "pointer-events: none;");
                            //$('#recency').hide();
                        }


                    } else {
                        $('#result').show();
                        setValue('result.value', 664);
                        $('#result').attr("style", "pointer-events: none;");
                    }

                });
            }
        });
    </script>


    <script>
        jQuery(function() {
            if (getField('tie_test_value.value') != null) {
                getField('tie_test_value.value').change(function() {

                    $('#result').hide();

                    var tietest = getValue('tie_test_value.value');

                    if (tietest == "1228") {
                        $('#result').show();
                        setValue('result.value', 703);
                        $('#result').attr("style", "pointer-events: none;");
                        //$('#recency').show();
                    } else {
                        $('#result').show();
                        setValue('result.value', 664);
                        $('#result').attr("style", "pointer-events: none;");
                        //$('#recency').hide();
                    }


                });
            }
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('tb_optout.value') != null) {
                getField('tb_optout.value').change(function() {

                    var optoutv = getValue('tb_optout.value');

                    if (optoutv == "1066") {
                        $('#test_name_dropdown').show();
                        setValue('test_name_dropdown.value', 166215);

                        if (getField('control_line.error') != null) {
                            getField('control_line.error').html('*').show();
                        }
                        if (getField('verification_line.error') != null) {
                            getField('verification_line.error').html('*').show();
                        }
                        if (getField('longterm_line.error') != null) {
                            getField('longterm_line.error').html('*').show();
                        }
                        if (getField('recency_number_verif_value.error') != null) {
                            getField('recency_number_verif_value.error').html('*').show();
                        }
                        if (getField('recency_test_date.error') != null) {
                            getField('recency_test_date.error').html('*').show();
                        }
                        if (getField('test_name_dropdown.error') != null) {
                            getField('test_name_dropdown.error').html('*').show();
                        }

                    }

                });
            }
        });
    </script>


    <script>
        jQuery(function() {
            if (getField('tb_vl_request.value') != null) {
                getField('tb_vl_request.value').change(function() {

                    var tbvl = getValue('tb_vl_request.value');

                    if (tbvl == "1065") {
                        //setValue('final_recency_value.value', 166237);

                    }




                });
            }
        });
    </script>

    <script>
        jQuery(function() {

            var urll = window.location.href;

            var pattern = /editHtml/;

            //returns true or false...
            var exists = pattern.test(urll);

            if (exists) {

                //true statement, do whatever

                $('#tb_optout').attr("style", "pointer-events: none;");
                $('#test_name_dropdown').attr("style", "pointer-events: none;");
                $('#recency_test_date').attr("style", "pointer-events: none;");
                $('#test_name').attr("style", "pointer-events: none;");
                //$('#recency_number_value').attr("style", "pointer-events: none;");
                //$('#recency_number_verif_value').attr("style", "pointer-events: none;");
                $('#control_line').attr("style", "pointer-events: none;");
                $('#verification_line').attr("style", "pointer-events: none;");
                $('#longterm_line').attr("style", "pointer-events: none;");
                $('#final_recency_test_recent').attr("style", "pointer-events: none;");


            } else {

                //false statement..do whatever
            }

        });
    </script>



    <script>
        jQuery(function() {
            if (getField('vl_result_clasification.value') != null) {
                getField('vl_result_clasification.value').change(function() {
                    var vlresult = getValue('vl_result_clasification.value');
                    var fnlrecency = getValue('final_recency_test_recent.value');
                    if (fnlrecency == "165852") {
                        if (vlresult == "166239") {
                            setValue('final_recency_value.value', 166236);
                            $('#final_recency_value').attr("style", "pointer-events: none;");
                        }
                        if (vlresult == "166240") {
                            setValue('final_recency_value.value', 166237);
                            $('#final_recency_value').attr("style", "pointer-events: none;");
                            //$('#vl_result_obs').attr("style", "pointer-events: none;");
                        }
                        if (vlresult == "166238") {
                            setValue('final_recency_value.value', 166235);
                            $('#final_recency_value').attr("style", "pointer-events: none;");
                        }


                    }


                });
            }
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('vl_result_clasification.value') != null) {
                getField('vl_result_clasification.value').change(function() {
                    var vlresult_entered = getValue('vl_result_clasification.value');
                    if (vlresult_entered != null) {
                        if (vlresult_entered == "166238") {
                            setValue('final_recency_value.value', 166235);
                        }
                        if (vlresult_entered == "166239") {
                            setValue('final_recency_value.value', 166236);
                        }
                        if (vlresult_entered == "166240") {
                            setValue('final_recency_value.value', 166237);
                        }
                    }
                });
            }
        });
    </script>

    <script>
        jQuery(function() {
            if (getField('control_line.value') != null) {
                getField('control_line.value').change(function() {
                    var ctrln = getValue('control_line.value');
                    if (ctrln == "1065") {
                        //setValue('final_recency_test_recent.value', 664);
                        //$('#final_recency_test_recent').attr("style", "pointer-events: none;");
                        //$('#tb_vl_request').attr("style", "pointer-events: none;");

                    } else {
                        //setValue('final_recency_test_recent.value', 163611);
                        //$('#final_recency_test_recent').attr("style", "pointer-events: none;");
                        //$('#tb_vl_request').attr("style", "pointer-events: none;");

                    }

                });
            }
        });
    </script>


    <script>
        jQuery(function() {
            if (getField('longterm_line.value') != null) {
                getField('longterm_line.value').change(function() {
                    var vffln = getValue('verification_line.value');
                    var ctrln = getValue('control_line.value');
                    var lngln = getValue('longterm_line.value');
                    if (ctrln == "1065") {
                        if (vffln == "1066") {
                            if (lngln == "1065") {
                                // setValue('final_recency_test_recent.value', 163611);
                                //$('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                //$('#tb_vl_request').attr("style", "pointer-events: none;");
                            }


                        } else {
                            if (lngln == "1065") {
                                //setValue('final_recency_test_recent.value', 165851);
                                //$('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                //$('#tb_vl_request').attr("style", "pointer-events: none;");
                            } else {
                                // setValue('final_recency_test_recent.value', 165852);
                                //$('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                //$('#tb_vl_request').attr("style", "pointer-events: auto;");
                            }
                        }


                    } else {
                        // setValue('final_recency_test_recent.value', 163611);
                        //$('#final_recency_test_recent').attr("style", "pointer-events: none;");
                        //$('#tb_vl_request').attr("style", "pointer-events: none;");

                    }

                });
            }
        });
    </script>


    <script>
        jQuery(function() {
            if (getField('final_recency_test_recent.value') != null) {
                getField('final_recency_test_recent.value').change(function() {
                    var frtr = getValue('final_recency_test_recent.value');

                    if (frtr == "165852") {

                        $('#tb_vl_request').attr("style", "pointer-events: auto;");
                        //setValue('tb_vl_request.value', 1066);

                    } else {
                        $('#tb_vl_request').attr("style", "pointer-events: none;");
                    }


                });
            }
        });
    </script>

    <script type="text/javascript">
        $(function() {

            $('#result').hide();

        });
    </script>

    <script>
        window.onload = function() {
            getField('completed_by.error').html('*').show();
            getField('date_of_visit.error').html('*').show();
            getField('signature_date.error').html('*').show();
            const myrecency_number_value = document.getElementById('recency_number_value');
            const myrecency_number_verif_value = document.getElementById('recency_number_verif_value');
            if (myrecency_number_value != null) {
                myrecency_number_value.onpaste = function(e) {
                    e.preventDefault();
                }
            }
            if (myrecency_number_verif_value != null) {
                myrecency_number_verif_value.onpaste = function(e) {
                    e.preventDefault();
                }
            }
        }
    </script>

    <script>
        jQuery(function() {
            if (document.getElementById("recency_number_value") != null) {
                document.getElementById("recency_number_value").addEventListener("change", function() {
                    var patientIdentifier_recency = $('input:text', '#recency_number_value').eq(0).val();
                    if (patientIdentifier_recency == "") {
                        window.alert('Please Participant ID can not be empty')
                        success.textContent = ""
                        outrange.textContent = ""
                        setValue('recency_number_verif_value.value', "")
                        return false;
                    } else {
                        getField('recency_number_verif_value.error').html('This field must be same as Participant ID').show();
                        success.textContent = ""
                        outrange.textContent = ""
                        setValue('recency_number_verif_value.value', "")
                        return false;
                    }

                    var userKeyRegExp = /^[A-Z][0-9]{8}$/;
                    if (patientIdentifier_recency.match(userKeyRegExp)) {
                        window.alert('Please Participant ID shuold only contain alphanumeric inputs with no special character')
                        success.textContent = ""
                        outrange.textContent = ""
                        setValue('recency_number_verif_value.value', "")
                        return false;
                    }

                    var recentID_verify = getValue('recency_number_verif_value.value');
                    if (recentID_verify != "") {
                        getField('recency_number_verif_value.error').html('Please confirm the Participant ID again here').show();
                        setValue('recency_number_verif_value.value', "")
                        success.textContent = ""
                        outrange.textContent = ""
                        return false;
                    }

                });
            }
            $('#recency_number_value').keypress(function (e) {
                var regex = new RegExp("^[a-zA-Z0-9]+$");
                var str = String.fromCharCode(!e.charCode ? e.which : e.charCode);
                if (regex.test(str)) {
                    return true;
                }

                e.preventDefault();
                return false;
            });
        });


        jQuery(function() {
            $('#final_recency_test_recent').attr("style", "pointer-events: none;");
            if (document.getElementById("control_line") != null) {
                document.getElementById("control_line").addEventListener("change", function() {
                    var control_line = getValue('control_line.value');
                    var verification_line = getValue('verification_line.value');
                    var longterm_line = getValue('longterm_line.value');
                    if (control_line == "1065") {
                        if (verification_line == "1065") {
                            if (longterm_line == "1065") {
                                setValue('final_recency_test_recent.value', 165851);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                setValue('tb_vl_request.value', "");
                                $('#tb_vl_request').attr("style", "pointer-events: none;");
                            }
                        }
                    }
                    if (control_line == "1065") {
                        if (verification_line == "1065") {
                            if (longterm_line == "1066") {
                                setValue('final_recency_test_recent.value', 165852);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                $('#tb_vl_request').attr("style", "pointer-events: unset;");
                            }
                        }
                    }
                    if (control_line == "1065") {
                        if (verification_line == "1066") {
                            if (longterm_line == "1066") {
                                setValue('final_recency_test_recent.value', 664);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                setValue('tb_vl_request.value', "");
                                $('#tb_vl_request').attr("style", "pointer-events: none;");
                            }
                        }
                    }
                    if (control_line == "1065") {
                        if (verification_line == "1066") {
                            if (longterm_line == "1065") {
                                setValue('final_recency_test_recent.value', 163611);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                setValue('tb_vl_request.value', "");
                                $('#tb_vl_request').attr("style", "pointer-events: none;");
                            }
                        }
                    }
                    if (control_line == "1066") {
                        setValue('final_recency_test_recent.value', 163611);
                        $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                        setValue('tb_vl_request.value', "");
                        $('#tb_vl_request').attr("style", "pointer-events: none;");

                    }

                });
            }
            if (document.getElementById("verification_line") != null) {
                document.getElementById("verification_line").addEventListener("change", function() {
                    var control_line = getValue('control_line.value');
                    var verification_line = getValue('verification_line.value');
                    var longterm_line = getValue('longterm_line.value');
                    if (control_line == "1065") {
                        if (verification_line == "1065") {
                            if (longterm_line == "1065") {
                                setValue('final_recency_test_recent.value', 165851);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                setValue('tb_vl_request.value', "");
                                $('#tb_vl_request').attr("style", "pointer-events: none;");
                            }
                        }
                    }
                    if (control_line == "1065") {
                        if (verification_line == "1065") {
                            if (longterm_line == "1066") {
                                setValue('final_recency_test_recent.value', 165852);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                $('#tb_vl_request').attr("style", "pointer-events: unset;");
                            }
                        }
                    }
                    if (control_line == "1065") {
                        if (verification_line == "1066") {
                            if (longterm_line == "1066") {
                                setValue('final_recency_test_recent.value', 664);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                setValue('tb_vl_request.value', "");
                                $('#tb_vl_request').attr("style", "pointer-events: none;");
                            }
                        }
                    }
                    if (control_line == "1065") {
                        if (verification_line == "1066") {
                            if (longterm_line == "1065") {
                                setValue('final_recency_test_recent.value', 163611);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                setValue('tb_vl_request.value', "");
                                $('#tb_vl_request').attr("style", "pointer-events: none;");
                            }
                        }
                    }
                    if (control_line == "1066") {
                        setValue('final_recency_test_recent.value', 163611);
                        $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                        setValue('tb_vl_request.value', "");
                        $('#tb_vl_request').attr("style", "pointer-events: none;");

                    }
                });
            }
            if (document.getElementById("longterm_line") != null) {
                document.getElementById("longterm_line").addEventListener("change", function() {
                    var control_line = getValue('control_line.value');
                    var verification_line = getValue('verification_line.value');
                    var longterm_line = getValue('longterm_line.value');
                    if (control_line == "1065") {
                        if (verification_line == "1065") {
                            if (longterm_line == "1065") {
                                setValue('final_recency_test_recent.value', 165851);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                setValue('tb_vl_request.value', "");
                                $('#tb_vl_request').attr("style", "pointer-events: none;");
                            }
                        }
                    }
                    if (control_line == "1065") {
                        if (verification_line == "1065") {
                            if (longterm_line == "1066") {
                                setValue('final_recency_test_recent.value', 165852);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                $('#tb_vl_request').attr("style", "pointer-events: unset;");
                            }
                        }
                    }
                    if (control_line == "1065") {
                        if (verification_line == "1066") {
                            if (longterm_line == "1066") {
                                setValue('final_recency_test_recent.value', 664);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                setValue('tb_vl_request.value', "");
                                $('#tb_vl_request').attr("style", "pointer-events: none;");
                            }
                        }
                    }
                    if (control_line == "1065") {
                        if (verification_line == "1066") {
                            if (longterm_line == "1065") {
                                setValue('final_recency_test_recent.value', 163611);
                                $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                                setValue('tb_vl_request.value', "");
                                $('#tb_vl_request').attr("style", "pointer-events: none;");
                            }
                        }
                    }
                    if (control_line == "1066") {
                        setValue('final_recency_test_recent.value', 163611);
                        $('#final_recency_test_recent').attr("style", "pointer-events: none;");
                        setValue('tb_vl_request.value', "");
                        $('#tb_vl_request').attr("style", "pointer-events: none;");
                    }
                });
            }

        });




        jQuery(function() {
            if (getField('recency_number_verif_value.value') != null) {
                getField('recency_number_verif_value.value').change(function() {

                    var recentID_verify2 = getValue('recency_number_verif_value.value');
                    var rec_num = getValue('recency_number_verif_value.value').length;
                    // window.alert('rec_num1:- ' +rec_num+' Out of Range');
                    var outrange = document.getElementById("outrange")
                    if (rec_num > 10) {
                        outrange.textContent = "#Participant ID must not be more than 10 characters"
                        getField('recency_number_verif_value.error').html('Participant ID must not be more than 10 characters').show();
                        success.textContent = "";
                        setValue('recency_number_verif_value.value', "");
                        return false;
                    }

                    var patientIdentifier_recency2 = $('input:text', '#recency_number_value').eq(0).val();
                    var success = document.getElementById("success")
                    if (recentID_verify2 == patientIdentifier_recency2) {
                        getField('recency_number_verif_value.error').html('Please enter the correct Participant ID again').hide();
                        success.textContent = "##Participant Recency ID length and format are same"
                        outrange.textContent = ""
                        return true;
                    } else {
                        window.alert('Please the "Verify Participant ID" does not match the initial Participant ID entered')
                        success.textContent = ""
                        outrange.textContent = ""
                        getField('recency_number_verif_value.error').html('Please enter the correct Participant ID again').show();
                        setValue('recency_number_verif_value.value', "")
                        return false;
                    }
                });
            }

        });
    </script>


    <!--    <div class="hidden" headerLabel="Encounter Details" headerStyle="title" id="encounter-details" sectionTag="section">-->
    <!--        <fieldset>-->
    <!--            <legend class="legend_style">When?</legend>-->
    <!--            <label>When?</label>-->
    <!--            <encounterDate allowFutureDates="false" default="now" showTime="false"/>-->
    <!--        </fieldset>-->

    <!--        <fieldset>-->
    <!--            <legend>Who?</legend>-->
    <!--            <label>Who?</label>-->
    <!--            <encounterProviderAndRole default="currentUser" encounterRole="240b26f9-dd88-4172-823d-4a8bfeb7841f" required="true"/>-->
    <!--        </fieldset>-->

    <!--        <fieldset>-->
    <!--            <legend>Where?</legend>-->
    <!--            <label>Where?</label>-->
    <!--            <encounterLocation default="SessionAttribute:emrContext.sessionLocationId"/>-->
    <!--        </fieldset>-->
    <!--    </div>-->

    <table style="margin-bottom: 20px;">
        <thead>
        <tr>
            <th style="text-align: center">Client Intake Form</th>
        </tr>
        </thead>
    </table>
    <table class="table" width="100%">
        <tr>
            <td class="alnleft_s">Client Code</td>

            <td class="alnleft_s" id="identifer-td">
                <patient field="identifier" identifierTypeId="8" required="true" />
            </td>
            <td style="vertical-align: top;">
                <label> <input id="preferred" name="preferred" type="checkbox" />preferred</label>
                <input id="pref_value" name="pref_value" type="hidden" />
                <input id="pref_type" name="pref_type" type="hidden" value="8" />
            </td>
        </tr>
        <tr>
            <td class="alnleft_s">Date of Visit</td>
            <td>
                <encounterDate allowFutureDates="false" id="date_of_visit" name="date_of_visit" required="true" showTime="false" />
                <enrollInProgram programId="4" showDate="false" />
            </td>
            <td>Kind of HTS</td>
            <td>
                <obs answerConceptIds="159940,164163" answerLabels="Voluntary,PITC" conceptId="166136" id="kind_of_hts">
                </obs>

            </td>

            <td class="alnleft_s" id="setting_name_pitc">Setting</td>
            <td class="alnleft_s" id="setting_pitc">
                <obs answerConceptIds="160539,160529,160546,5271,160542,161629,160545,165838,166135,5622" answerLabels="VCT,TB,STI,FP,OPD,Ward,Outreach program,Standalone HTS, Community ART, Others" conceptId="165839" id="setting" required="true">
                    <controls>
                        <when thenDisplay="#setting_other" value="5622" />
                    </controls>
                </obs>
            </td>

        </tr>



        <tr id="setting_other">
            <td class="alnleft_s"> </td>
            <td class="alnleft_s"> </td>
            <td class="alnleft_s"> </td>
            <td class="alnleft_s"></td>
            <td class="alnleft_s">Others, Specify</td>
            <td class="alnleft_s">
                <obs conceptId="165966" required="true"/>
            </td>
        </tr>

        <tr>
            <td class="alnleft_s">First Time Visit</td>
            <td class="alnleft_s">
                <obs conceptId="165790" />
            </td>
            <td class="alnleft_s">Type of Session</td>
            <td class="alnleft_s">
                <obs answerConceptIds="165792,165789,165885" answerLabels="Individual, Couple, Previously self tested" conceptId="165793" required="true"/>
            </td>
            <td class="alnleft_s">Referred from</td>
            <td class="alnleft_s">
                <obs answerConceptIds="978,160529,160546,5271,160542,161629,165788,5622" answerLabels="Self,TB,STI,FP,OPD,Ward,Blood Bank,Others" conceptId="165480" required="true"/>
            </td>
        </tr>
        <tr id="marital_setting">
            <td class="alnleft_s" id="marital_status_label">Marital Status</td>
            <td class="alnleft_s" id="marital_status">
                <obs answerConceptIds="1057,5555,1058,1056,1060,1059" answerLabels="Single,Married,Divorced,Separated, Cohabiting,Widower" conceptId="1054" id="obs_result">
                    <includeIf velocityTest="$patient.gender == 'M' ">
                        <controls>
                            <when thenDisplay="#no_wives_label,#no_wives" value="5555" />

                        </controls>

                    </includeIf>


                </obs>
            </td>

            <td class="alnleft_s" id="no_children_label">No. of own children &lt; 5</td>
            <td class="alnleft_s" id="no_children">
                <obs conceptId="160312" id="no_children_less_than_5" />
            </td>
            <td class="alnleft_s" id="no_wives_label">Numbers of wives/Co-wives</td>
            <td class="alnleft_s" id="no_wives">
                <obs conceptId="5557" />
            </td>
        </tr>
        <tr>
            <td class="alnleft_s">Is client identified from an index client?</td>
            <td class="alnleft_s">
                <obs conceptId="165794" id="index">
                    <controls>
                        <when thenDisplay="#index_type_label,#index_type_name,#index_id_label,#index_id_text" value="1065" />
                    </controls>
                </obs>
            </td>
            <td class="alnleft_s" id="index_type_label">Index Type</td>
            <td class="alnleft_s" id="index_type_name">
                <obs answerConceptIds="165796,165797,165795" answerLabels="Biological,Sexual,Social (needle sharing)" conceptId="165798" /> </td>
            <td class="alnleft_s" id="index_id_label">Index Client ID</td>
            <td class="alnleft_s" id="index_id_text">
                <obs conceptId="165859" /> </td>
        </tr>
        <tr>
            <td class="alnleft_s">Is client retesting for result verification?</td>
            <td class="alnleft_s">
                <obs conceptId="165976" />
            </td>
            <td class="alnleft_s"></td>
            <td class="alnleft_s"></td>
            <td class="alnleft_s"></td>
            <td class="alnleft_s"></td>
        </tr>
    </table>

    <br/>

    <fieldset>
        <legend class="legend_style">Pre-Test Information</legend>
        <table class="table" width="100%">
            <tr>
                <td colspan="2"><b>Knowledge Assesment</b></td>
                <td colspan="2"><b>HIV Risk Assesment</b></td>
            </tr>
            <tr>
                <td>Previously tested HIV negative</td>
                <td>
                    <obs conceptId="165799" />
                </td>
                <td>Ever had sexual intercourse</td>
                <td>
                    <obs conceptId="165800" id="risk_ever_had_sex" />
                </td>
            </tr>

            <tr>
                <includeIf velocityTest="$patient.gender == 'F' ">
                    <td>Client Pregnant (Test and ensure linkage to PMTCT Program)</td>
                    <td>
                        <obs conceptId="1434" style="no_yes_dropdown" />
                    </td>
                </includeIf>

                <td>Blood transfusion in last 3 months</td>
                <td>
                    <obs conceptId="1063" id="risk_blood_trans_3_months" style="no_yes_dropdown" /> </td>
            </tr>

            <tr>
                <td>Client informed about HIV transmission routes</td>
                <td>
                    <obs conceptId="165801" />
                </td>

                <td>Unprotected sex with casual partner in last 3 months</td>
                <td>
                    <obs answerConceptIds="1066,1065" answerLabels="No,Yes" conceptId="159218" id="risk_unprotected_sex_casual" style="yes_no_dropdown" /> </td>
            </tr>

            <tr>
                <td>Client informed about risk factors for HIV transmission </td>
                <td>
                    <obs conceptId="165802" />
                </td>
                <td>Unprotected sex with regular partner in the last 3 months </td>
                <td>
                    <obs conceptId="165803" id="risk_unprotected_sex_regular" />
                </td>
            </tr>

            <tr>
                <td>Client informed on preventing HIV transmission methods </td>
                <td>
                    <obs conceptId="165804" /> </td>
                <td>STI in last 3 months</td>
                <td>
                    <obs conceptId="164809" id="risk_sti_last_3_months" />
                </td>
            </tr>

            <tr>
                <td>Client informed about possible test results</td>
                <td>
                    <obs conceptId="165884" /> </td>
                <td>More than 1 sex partner during last 3 months</td>
                <td>
                    <obs conceptId="165806" id="risk_more_than_one_sex_partner" />
                </td>
            </tr>

            <tr>
                <td>Informed consent for HIV testing given</td>
                <td>
                    <obs conceptId="1710" style="no_yes_dropdown" /> </td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td>Risk Assesment Score</td>
                <td>
                    <obs conceptId="165807" id="get_total_risk_val" />
                </td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td colspan="2"><b>Client TB Screening</b></td>
                <td colspan="2"><b>Syndromic STI Screening</b></td>
            </tr>
            <tr>
                <td>Current Cough</td>
                <td>
                    <obs answerConceptIds="1066,1065" answerLabels="No,Yes" conceptId="143264" id="tb_current_cough" />
                </td>
                <includeIf velocityTest="$patient.gender == 'F' ">
                    <td>Complaints of vaginal discharge or burning when urinating?</td>
                    <td>
                        <obs conceptId="165809" id="complaint_vaginal_discharge" />
                    </td>
                </includeIf>
            </tr>

            <tr>
                <td>Weight Loss</td>
                <td>
                    <obs conceptId="832" id="tb_weight_loss" style="no_yes_dropdown" />
                </td>
                <includeIf velocityTest="$patient.gender == 'F' ">
                    <td>Complaints of lower abdominal pains with or without vaginal discharge?
                    </td>
                    <td>
                        <obs conceptId="165810" id="complaint_lowwer_abdominal_pain" />
                    </td>
                </includeIf>
            </tr>
            <tr>
                <td>Fever</td>
                <td>
                    <obs answerConceptIds="1066,1065" answerLabels="No,Yes" conceptId="140238" id="tb_fever" />
                </td>
                <includeIf velocityTest="$patient.gender == 'M' ">
                    <td>Complaints of urethral discharge or burning when urinating?</td>
                    <td>
                        <obs conceptId="165811" id="urethral_discharge" /> </td>
                </includeIf>
            </tr>
            <tr>
                <td>Night sweats</td>
                <td>
                    <obs conceptId="133027" id="tb_night_sweats" style="no_yes_dropdown" />
                </td>
                <includeIf velocityTest="$patient.gender == 'M' ">
                    <td>Complaints of scrotal swelling and pain</td>
                    <td>
                        <obs conceptId="165812" id="scrotal_swelling" /> </td>
                </includeIf>
            </tr>
            <tr>
                <td>Contact with TB+ patient</td>
                <td>
                    <obs answerConceptIds="1066,1065" answerLabels="No,Yes" conceptId="124068" id="contact_with_TB" />
                </td>
                <td>Complaints of genital sore(s) or swollen inguinal lymph nodes with or without pains?</td>
                <td>
                    <obs conceptId="165813" id="complaint_genital_sore" /> </td>
            </tr>
            <tr>
                <td>TB Screening Score</td>
                <td>
                    <obs conceptId="165808" id="get_total_tb_val" />
                </td>
                <td>STI Screening Score</td>
                <td>
                    <obs conceptId="165814" id="get_total_sti_val" /> </td>
            </tr>
            <tr>
                <td></td>
                <td><span id="tb_action_message" style="font-style:italic"></span></td>
                <td></td>
                <td><span id="sti_action_message" style="font-style:italic"></span></td>
            </tr>
        </table>
    </fieldset><br/>
    <fieldset id="cd4_test">
        <legend class="legend_style">Baseline CD4 Test Results</legend>
        <table class="table" width="100%">
            <tr>
                <td class="alnleft">
                    <obs conceptId="165731" style="checkbox" value="false" />CD4+ cell count (cells/mm3)</td>
                <td>
                    <obs conceptId="5497" />
                </td>
                <td class="alnleft">
                    <obs conceptId="165748" style="checkbox" value="false" />CD4 (%)</td>
                <td>
                    <obs conceptId="730" />
                </td>
            </tr>
        </table>
    </fieldset>
    <br/>
    <fieldset id="hiv_result">
        <legend class="legend_style">HIV Test Results</legend>
        <table class="table" width="100%">
            <tr>
                <td class="alnleft"></td>
                <td class="alnleft"><b>Screening test</b></td>
                <td class="alnleft" id="confirm_test_label"><b>Confirmatory test</b></td>
                <td class="alnleft" id="tie_test_label"><b>Tie breaker</b></td>
            </tr>
            <tr>
                <td class="alnleft"><b>Test result</b></td>
                <td class="alnleft">
                    <obs answerConceptIds="1228,1229" answerLabels="Reactive,Non-reactive" conceptId="165840" id="screen_test_value" name="screen_test_value">
                        <controls>

                            <when thenDisplay="#confirm_test,#confirm_test_date,#confirm_test_label,#pns_details,#recency" value="1228" />

                        </controls>
                    </obs>

                </td>



                <td class="alnleft" id="confirm_test">
                    <obs answerConceptIds="1228,1229" answerLabels="Reactive,Non-reactive" conceptId="165841" id="confirm_test_value">
                        <controls>
                            <when thenDisplay="#tie_test,#tie_test_date,#tie_test_label" value="1229" />
                        </controls>
                    </obs>
                </td>
                <td class="alnleft" id="tie_test">
                    <obs answerConceptIds="1228,1229" answerLabels="Reactive,Non-reactive" conceptId="165842" id="tie_test_value" />
                </td>


            </tr>
            <tr>
                <td class="alnleft"><b>Test date</b></td>
                <td class="alnleft">
                    <obs allowFutureDates="false" conceptId="165844" id="hiv_test_date" showTime="false" />
                </td>
                <td class="alnleft">
                    <obs allowFutureDates="false" conceptId="165845" id="confirm_test_date" showTime="false" />
                </td>

                <td class="alnleft">
                    <obs allowFutureDates="false" conceptId="165846" id="tie_test_date" showTime="false" />
                </td>


            </tr>
            <tr>
                <td class="alnleft" id="result_label" name="result_label"><b>Final Result</b></td>
                <td class="alnleft">
                    <obs answerConceptIds="703,664" answerLabels="Positive,Negative" conceptId="165843" id="result" name="result">

                        <controls>
                            <when thenDisplay="#pns_details" value="703" />
                        </controls>
                    </obs>
                </td>



            </tr>
        </table>
    </fieldset>

    <includeIf velocityTest="$patient.getAge($encounter.getEncounterDatetime()) > 14 ">

        <fieldset id="recency" name="recency">


            <legend class="legend_style">HIV Recency Testing</legend>


            <table class="table" width="100%">

                <tr>

                    <td>Opt Out of RTRI?</td>

                    <td>
                        <obs answerConceptIds="1066,1065" answerLabels="No,Yes" conceptId="165805" id="tb_optout">

                            <controls>
                                <when thenDisplay="#control_line_label,#control_line,#verification_line_label,#verification_line,#longterm_line_label,#longterm_line,#recency_number_label,#recency_number_value, #viral_load_table, #recency_table, #recency_number_verif_label,#recency_number_verif_value,#recency_warning_label,#test_name_dropdown,#recency_test_date,#recency_test_date_label,#test_name_label,#preferred_recency,#preferred_recency_label,#identifier_label"
                                      value="1066" />
                            </controls>

                        </obs>
                    </td>

                </tr>


                <tr>
                    <td class="alnleft_s" id="test_name_label" name="test_name_label">Test name</td>
                    <td class="alnleft">
                        <obs answerConceptIds="166215, 5622" answerLabels="Asante, Others" conceptId="166216" id="test_name_dropdown" name="test_name_dropdown">

                            <controls>
                                <when thenDisplay="#test_name" value="5622" />
                            </controls>
                        </obs>
                    </td>

                    <td class="alnleft_s" id="recency_test_date_label" name="recency_test_date_label">Test date</td>
                    <td class="alnleft_s">
                        <obs allowFutureDates="false" conceptId="165850" id="recency_test_date" name="recency_test_date" />
                    </td>
                    <td class="alnright_s"></td>
                    <td class="alnleft_s"></td>


                </tr>
                <tr>

                    <td class="alnleft_s"></td>
                    <td class="alnleft_s" id="test_name">
                        <obs conceptId="165849" />
                    </td>

                </tr>

                <tr>

                    <td id="recency_warning_label" style="width: 100%; color:red">Participant ID must not be more than 10 characters with atleast 2 Uppercase Alphabets present</td>

                </tr>
                <tr>
                    <td id="recency_number_label">Participant ID:</td>

                    <td class="alnleft_s" id="recency_number_value">
                        <patient field="identifier" required="false" />
                    </td>
                    <td style="vertical-align: top;">
                        <label id="preferred_recency_label" name="preferred_recency_label">
                            <input id="preferred_recency" name="preferred_recency" type="checkbox" />preferred
                        </label>
                    </td>

                    <td colspan="2"> <span id="outrange" style="width:100%; color:red; font-weight:bold;"></span> </td>
                </tr>

                <tr>
                    <td id="recency_number_verif_label">Verify Participant ID</td>

                    <td class="alnleft_s">
                        <obs conceptId="166210" id="recency_number_verif_value" required="false" />
                    </td>
                    <td colspan="2"> <span id="success" style="width:100%; color:green; font-weight:bold;"></span> </td>
                </tr>



                <tr>
                    <td id="control_line_label">Control Line</td>
                    <td>
                        <obs answerConceptIds="1066,1065" answerLabels="No,Yes" conceptId="166212" id="control_line" />
                    </td>

                    <td id="verification_line_label">Verification Line</td>
                    <td>
                        <obs answerConceptIds="1066,1065" answerLabels="No,Yes" conceptId="166243" id="verification_line" />
                    </td>

                    <td id="longterm_line_label">Long-Term Line</td>
                    <td>
                        <obs answerConceptIds="1066,1065" answerLabels="No,Yes" conceptId="166211" id="longterm_line" />
                    </td>


                </tr>
            </table>
            <table>
                <tr>

                    <td colspan="2"> </td>
                </tr>
            </table>
            <table id="recency_table">

                <tr>
                    <td class="alnleft_f"><b>Recency Interpretation</b></td>

                    <td class="alnleft_f">
                        <obs answerConceptIds="165852,165851,664,163611" answerLabels="Recent,Long Term,Negative,Invalid" conceptId="166213" id="final_recency_test_recent">
                            <controls>
                                <when thenDisplay="#viral_load_table" value="165852" />
                            </controls>
                        </obs>
                    </td>
                    <td colspan="3"> </td>
                </tr>

            </table>


            <table id="viral_load_table">

                <td>Has viral load request been made?</td>
                <tr>
                    <td>
                        <obs answerConceptIds="1066,1065" answerLabels="No,Yes" conceptId="166244" id="tb_vl_request">
                            <controls>
                                <when thenDisplay="#new_tag"
                                      value="1065" />
                            </controls>

                        </obs>
                    </td>
                </tr>
            </table>


            <table id="new_tag">
                <tr>
                    <td class="alnleft_f" id="vl_value"><b>Viral load confirmation</b></td>
                    <td colspan="3"></td>
                </tr>

                <tr>
                    <td class="alnleft_f" id="vl_value">Sample collection date</td>
                    <td class="alnleft_f">
                        <obs allowFutureDates="false" conceptId="159951" id="vlsample_value_obs" name="vlsample_value_obs" />
                    </td>
                    <td id="sample_id_label">Sample Reference Number:</td>
                    <td>
                        <obs conceptId="165715" id="sample_id" />
                    </td>
                </tr>
                <tr>
                    <td id="vl_samplet">Sample Type</td>
                    <td>
                        <obs answerConceptIds="1002,165568" answerLabels="Plasma,DBS" conceptId="162476" id="sample_type" />
                    </td>
                    <td class="alnleft_f" id="vl_dss">Date Sample Sent to PCR Lab</td>
                    <td class="alnleft_f">
                        <obs allowFutureDates="false" conceptId="165988" id="vlpcr_value_obs" name="vlpcr_value_obs" />
                    </td>
                </tr>
                <tr>
                    <td id="vl_samplet">Date sample received at PCR Lab</td>
                    <td class="alnleft_f">
                        <obs allowFutureDates="false" conceptId="165716" />
                    </td>
                    <td class="alnleft_f" id="vl_dss">Date result was sent from PCR Lab</td>
                    <td class="alnleft_f">
                        <obs allowFutureDates="false" conceptId="165989" />
                    </td>
                </tr>
                <tr>
                    <td class="alnleft_s">Date Sample Ordered</td>
                    <td>
                        <obs conceptId="164989" allowFutureDates="false" />
                    </td>
                    <td class="alnleft_s">Date result was received at the facility</td>
                    <td>
                        <obs conceptId="165987" allowFutureDates="false" />
                    </td>
                </tr>
                <tr>
                    <td class="alnleft_f" id="vl_rpcr">Receiving PCR Lab</td>
                    <td class="alnleft_f">
                        <obs answerConceptIds="166234,166217,166218,166219,166220,166221,166232,166222,166223,166224,166225,166226,166227,166228,166229,166230,166231" answerLabels="68 NARH Yaba Lagos,Ahmadu Bello University Teaching Hospital (ABUTH),Chukwuemeka Odumegwu Ojukwu University Teaching Hospital (COOUTH),Rivers State University Hospital (RSUTH),Defence Reference laboratory (DRL) Abuja,Federal Medical Center Makurdi,Federal Medical Center Jalingo,Federal Teaching Hospital (FTH) Gombe,Jos University Teaching Hospital (JUTH) Jos,Lagos State University Teaching Hospital (LASUTH) Lagos,National Reference Laboratory Gaduwa (NRL) Abuja,Nigerian Institute of Medical Research (NIMR) Lagos,Nnamdi Azikiwe University Teaching Hospital (NAUTH),Obafemi Awolowo University Teaching Hospital (OAUTH) Ile-Ife,University of Maiduguri Teaching Hospital (UMTH) Maiduguri,University of Uyo teaching Hospital (UUTH) Uyo,Usman Danfodio University Teaching Hospital (UDUTH)"
                             conceptId="166233" id="receiving_lab" />
                    </td>
                    <td class="alnleft_f" id="vl_result_label">Viral Load Result Classification:</td>
                    <td class="alnleft_f">
                        <obs answerConceptIds="166238,166239,166240" answerLabels="&lt;1000,&gt;=1000,Failed VL" conceptId="166241" id="vl_result_clasification" />
                    </td>
                </tr>

                <tr>
                    <td class="alnleft_f" id="vl_result">Result (copies/ml)</td>
                    <td class="alnleft_f">
                        <obs conceptId="856" id="vl_result_obs" name="vl_result_obs" />
                    </td>
                    <td class="alnleft_f" id="final_recency_label">Final Recency Result:</td>
                    <td class="alnleft_f">
                        <obs answerConceptIds="166236,166235,166237" answerLabels="RITA Recent,Long-Term Infection,Rita Inconclusive" conceptId="166214" id="final_recency_value" />

                    </td>
                </tr>
                <tr>
                    <td class="alnleft_f">Assay Date</td>
                    <td class="alnleft_f">
                        <obs conceptId="166424" allowFutureDates="false" />
                    </td>
                    <td class="alnleft_f">Approval Date</td>
                    <td class="alnleft_f">
                        <obs conceptId="166425" allowFutureDates="false" />
                    </td>
                </tr>
                <tr>
                    <td class="alnleft_f">Result Date</td>
                    <td class="alnleft_f">
                        <obs conceptId="166423" allowFutureDates="false" />
                    </td>
                    <td class="alnleft_f" id="vl_value">Sample test date</td>
                    <td class="alnleft_f">
                        <obs allowFutureDates="false" conceptId="165854" id="vl_value_obs" name="vl_value_obs" />
                    </td>
                </tr>

                <tr>
                    <td colspan="4" id="another_recency_warning_label" style="width: 100%; color:red">Please verify the correctness of all fields from the paper form before submission.</td>
                </tr>

            </table>


        </fieldset>

    </includeIf>

    <fieldset>
        <legend class="legend_style">Post Test Counseling</legend>
        <table class="table" width="100%">
            <!--<tr>-->
            <!--<td colspan="1">Initial HIV Test:</td>-->
            <!--<td><obs conceptId="1040" /></td>-->
            <!--<td colspan="1">Confirmatory HIV Test:</td>-->
            <!--<td><obs conceptId="1326" /></td>-->

            <!--</tr>-->

        </table>
        <table class="table" width="100%">
            <tr>
            <tr>
                <td>Have you been tested for HIV before within this year</td>
                <td>
                    <obs conceptId="165881" />
                </td>
                <td>Risk reduction plan developed</td>
                <td>
                    <obs conceptId="165820" />
                </td>
            </tr>
            <tr>
                <td>HIV Request and Result form signed by tester(s)</td>
                <td>
                    <obs conceptId="165818" />
                </td>
                <td>Post test disclosure plan developed</td>
                <td>
                    <obs conceptId="165821" />
                </td>
            </tr>
            <tr>
                <td>HIV Request and Result form filled with CT Intake Form</td>
                <td>
                    <obs conceptId="165819" />
                </td>
                <td>Will bring partner(s) for HIV testing</td>
                <td>
                    <obs conceptId="165822" />
                </td>
            </tr>
            <tr>
                <td>Client received HIV test result</td>
                <td>
                    <obs answerConceptIds="1066,1065" answerLabels="No, Yes" conceptId="164848" />
                </td>
                <td>Will bring own children less than 5 years for HIV testing</td>
                <td>
                    <obs conceptId="165823" />
                </td>
            </tr>
            <tr>
                <td>Post test counseling done</td>
                <td>
                    <obs id="post_test_counseling" answerConceptIds="1066,1065" answerLabels="No, Yes" conceptId="159382" />
                </td>
                <td>Provided with information on FP and dual contraception</td>
                <td>
                    <obs answerConceptIds="1066,1065" answerLabels="No, Yes" conceptId="1382" />
                </td>
            </tr>
            <tr>
                <td>Client/partner use FP methods (other than condom):</td>
                <td>
                    <obs conceptId="165883" />
                </td>
                <td>Correct condom use demonstrated</td>
                <td>
                    <obs conceptId="165824" />
                </td>
            </tr>
            <tr>
                <td>Client/partner use condoms as (one) FP method</td>
                <td>
                    <obs conceptId="5571" style="no_yes_dropdown" />
                </td>
                <td>Condoms provided to client</td>
                <td>
                    <obs answerConceptIds="1066,1065" answerLabels="No, Yes" conceptId="159777" />
                </td>
            </tr>
            <tr>
                <td>Client referred to other services</td>
                <td>
                    <obs conceptId="1648" style="no_yes_dropdown" />
                </td>
            </tr>
            <tr>
                <td>Comments</td>
                <td colspan="3">
                    <obs conceptId="165045" rows="2" /> </td>
            </tr>

            </tr>

        </table>
    </fieldset><br/>

    <fieldset id="pns_details">
        <legend class="legend_style">Index Notification Services - Elicitation</legend>

        <tr>
            <td><b>Consent given for index elicitation and contact</b></td>
            <td>
                <obs answerConceptIds="1065,1066" conceptId="164800" id="consent_asked" style="yes_no_dropdown">
                    <controls>
                        <when thenDisplay="#pns_details_display" value="1065" />
                    </controls>
                </obs>
            </td>
        </tr>
        <br/>
        <table class="table" id="pns_details_display" width="100%">
            <tr>
                <td class="alnleft" colspan="3"><b>Partner Name:</b></td>
                <td class="alnleft"><b>Partner Gender</b></td>
                <td class="alnleft"><b>Index Relation</b></td>
                <td class="alnleft"><b>Descriptive Address</b></td>
                <td class="alnleft"><b>Phone Number</b></td>
            </tr>
            <tr>
                <obsgroup groupingConceptId="165858">
                    <td class="alnleft" colspan="3">
                        <obs conceptId="161135" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165184,165185" answerLabels="Male,Female" conceptId="165857" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165796,165797,165795" answerLabels="Biological,Sexual,Social(needle sharing)" conceptId="165798" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166021" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166022" />
                    </td>

                </obsgroup>
            </tr>
            <tr>
                <obsgroup groupingConceptId="165858">
                    <td class="alnleft" colspan="3">
                        <obs conceptId="161135" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165184,165185" answerLabels="Male,Female" conceptId="165857" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165796,165797,165795" answerLabels="Biological,Sexual,Social(needle sharing)" conceptId="165798" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166021" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166022" />
                    </td>

                </obsgroup>
            </tr>
            <tr>
                <obsgroup groupingConceptId="165858">
                    <td class="alnleft" colspan="3">
                        <obs conceptId="161135" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165184,165185" answerLabels="Male,Female" conceptId="165857" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165796,165797,165795" answerLabels="Biological,Sexual,Social(needle sharing)" conceptId="165798" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166021" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166022" />
                    </td>
                </obsgroup>
            </tr>


            <tr>
                <obsgroup groupingConceptId="165858">
                    <td class="alnleft" colspan="3">
                        <obs conceptId="161135" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165184,165185" answerLabels="Male,Female" conceptId="165857" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165796,165797,165795" answerLabels="Biological,Sexual,Social(needle sharing)" conceptId="165798" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166021" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166022" />
                    </td>
                </obsgroup>
            </tr>
            <tr>
                <obsgroup groupingConceptId="165858">
                    <td class="alnleft" colspan="3">
                        <obs conceptId="161135" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165184,165185" answerLabels="Male,Female" conceptId="165857" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165796,165797,165795" answerLabels="Biological,Sexual,Social(needle sharing)" conceptId="165798" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166021" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166022" />
                    </td>

                </obsgroup>
            </tr>
            <tr>
                <obsgroup groupingConceptId="165858">
                    <td class="alnleft" colspan="3">
                        <obs conceptId="161135" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165184,165185" answerLabels="Male,Female" conceptId="165857" />
                    </td>
                    <td class="alnleft">
                        <obs answerConceptIds="165796,165797,165795" answerLabels="Biological,Sexual,Social(needle sharing)" conceptId="165798" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166021" />
                    </td>
                    <td class="alnleft">
                        <obs conceptId="166022" />
                    </td>
                </obsgroup>
            </tr>

        </table>
    </fieldset>
    <fieldset>
        <table class="table" width="100%">
            <tr>
                <td class="alnleft_s">Syphilis test result:</td>
                <td class="alnleft_s">
                    <obs answerConceptIds="1228,1229" answerLabels="Reactive,Non-reactive" conceptId="299" />
                </td>
                <td class="alnleft_s">Hepatitis B virus test result:</td>
                <td class="alnleft_s">
                    <obs answerConceptIds="703,664" answerLabels="Positive,Negative" conceptId="159430" />
                </td>
                <td class="alnleft_s">Hepatitis C virus test result:</td>
                <td class="alnleft_s">
                    <obs answerConceptIds="703,664" answerLabels="Positive,Negative" conceptId="161471" />
                </td>
            </tr>
        </table>
    </fieldset>


    <!-- UPDATED -->
    <fieldset>
        <legend class="legend_style">Key Population</legend>
        <table width="100%" border="0">
            <td>
                <table>
                    <td>
                        <tr>
                            <td class="alnleft_s">KP</td>
                            <td>
                                <obs id="key_pop" style="yes_no_dropdown" conceptId="166284">
                                    <controls>
                                        <when value="true" thenDisplay="#key_pop_type" />
                                    </controls>
                                </obs>
                            </td>
                        </tr>
                    </td>
                </table>
            </td>

            <td>
                <table class="table" width="100%" id="key_pop_type">
                    <includeIf velocityTest="$patient.gender == 'F' ">
                        <tr>
                            <td>FSW
                                <obs conceptId="166369" answerConceptId="166285" answerLabel="" />
                            </td>
                        </tr>
                    </includeIf>

                    <includeIf velocityTest="$patient.gender == 'M' ">
                        <tr>
                            <td>MSM
                                <obs conceptId="166369" answerConceptId="160578" answerLabel="" />
                            </td>
                        </tr>
                    </includeIf>
                    <tr>
                        <td>PWID
                            <obs conceptId="166369" answerConceptId="166286" answerLabel="" />
                        </td>
                    </tr>
                    <tr>
                        <td>TG
                            <obs conceptId="166369" answerConceptId="166287" answerLabel="" />
                        </td>
                    </tr>
                    <tr>
                        <td>People in prisons and other enclosed settings
                            <obs conceptId="166369" answerConceptId="162277" answerLabel="" />
                        </td>
                    </tr>
                </table>
            </td>
        </table>
    </fieldset>


    <fieldset>
        <legend class="legend_style">Signature and date: </legend>
        <table class="table" width="100%">
            <tr>
                <td class="alnleft">Date:</td>
                <td class="alnleft">
                    <obs allowFutureDates="false" conceptId="166242" id="signature_date" showTime="false" />
                </td>
                <td class="alnleft">Completed by:</td>
                <td class="alnleft">
                    <encounterProvider id="completed_by" name="completed_by" />
                </td>
                <td>Location:</td>
                <td>
                    <encounterLocation default="SessionAttribute:emrContext.sessionLocationId" />
                </td>
            </tr>
        </table>
    </fieldset>
    <submit/>
    <script type="text/javascript">

        beforeSubmit.push(function() {
            var dob = '<lookup expression="patient.birthdate" />';
            var visitDate = new Date(getValue('date_of_visit.value'));
            var timeDiff =  visitDate.getTime() - new Date(dob).getTime();
            var daysDiff =  timeDiff / (1000 * 3600 * 24);

            if(daysDiff &lt; 0) {
                alert("Encounter date "+visitDate.getDay()+"/"+visitDate.getMonth()+"/"+visitDate.getFullYear()+" cannot be before patient's date of birth "+dob+".")
                return false;
            }

            if((daysDiff / 365) &gt;= 60){
                if(!confirm("Client age is greater than 59, continue?")){
                    return false;
                }
            }

            var no_children_less_than_5 = getValue('no_children_less_than_5.value');

            if(no_children_less_than_5){
                if(no_children_less_than_5 &lt; 0){
                    getField('no_children_less_than_5.error').html("Number of children less than 5 years can not be a negative number.").show();
                    return false;
                }
            }

            var tb_optout = getValue('tb_optout.value');

            //var recency_number_value= getValue('recency_number_value.value');
            // var recency_number_value = $('input:text', '#recency_number_value').eq(0).val();
            var recency_number_verif_value = getValue('recency_number_verif_value.value');
            var control_line = getValue('control_line.value');
            var verification_line = getValue('verification_line.value');
            var longterm_line = getValue('longterm_line.value');
            var final_recency_test_recent = getValue('final_recency_test_recent.value');
            var final_recency_value = getValue('final_recency_value.value');
            var recency_test_date = getValue('recency_test_date.value');
            var test_name_dropdown = getValue('test_name_dropdown.value');
            //var vl_result_obs = getValue('vl_result_obs.value');
            //var longterm_line = getValue('longterm_line.value');

            if (tb_optout === "1066") {

                //var userKeyRegExp = /^[A-Z][A-Z][0-9]{8}$/;
                //var recencyNum= getValue('recency_number_value.value');

                //var recencyNum= $('input:text', '#recency_number_value').eq(0).val();
                var recencyVer = getValue('recency_number_verif_value.value');

                var patientIdentifier_recency = $('input:text', '#recency_number_value').eq(0).val();
                var userKeyRegExp = /^[A-Z][A-Z][0-9]{8}$/;

                var vlresultT = getValue('vl_result_clasification.value');
                var vlresultobs = getValue('vl_result_obs.value');
                if (vlresultT === "166239") {
                    if (vlresultobs &lt; 1000) {
                        getField('vl_result_obs.error').html('Result (copies/ml) cannot be less than 1000 if Viral Load Result Classification is greater than 1000').show();
                        return false;
                    }
                }
                if (vlresultT === "166238") {
                    if (vlresultobs >= 1000) {
                        getField('vl_result_obs.error').html('Result (copies/ml) cannot be  1000 or greater if Viral Load Result Classification is less than 1000').show();
                        return false;
                    }
                }
                if (vlresultT === "166240") {
                    if (vlresultobs != "") {
                        getField('vl_result_obs.error').html('Result (copies/ml) should be empty if Viral Load Result Classification is Failed VL').show();
                        return false;
                    }
                }

                if (test_name_dropdown === "") {
                    getField('test_name_dropdown.error').html('Recency Test Name cannot be empty').show();
                    return false;
                }

                if (recency_test_date === "") {
                    getField('recency_test_date.error').html('Recency Test Date cannot be empty').show();
                    return false;
                }

                if (recency_number_verif_value === "") {
                    getField('recency_number_verif_value.error').html('Participant ID Verification cannot be empty').show();
                    return false;
                }

                if (control_line === "") {
                    getField('control_line.error').html('Control Line cannot be empty').show();
                    return false;
                }

                if (verification_line === "") {
                    getField('verification_line.error').html('Verification Line cannot be empty').show();
                    return false;
                }

                if (longterm_line == "") {
                    getField('longterm_line.error').html('Long Term cannot be empty').show();
                    return false;
                }

                if (final_recency_test_recent == "") {
                    getField('final_recency_test_recent.error').html('Recency Interpretation cannot be empty').show();
                    return false;
                }

                var testVal = new Date(getValue('hiv_test_date.value'));
                var rctd = new Date(getValue('recency_test_date.value'));

                if (testVal > rctd) {
                    getField('recency_test_date.error').html('Recency Test Date cannot be earlier than Screening Test Date').show();
                    return false;
                }

                var confirmVal = new Date(getValue('confirm_test_date.value'));
                var visitVal = new Date(getValue('date_of_visit.value'));

                var tieVal = new Date(getValue('tie_test_date.value'));
                var rctdd = new Date(getValue('recency_test_date.value'));
                var vlpcr = new Date(getValue('vlpcr_value_obs.value'));

                var vlvalue = new Date(getValue('vl_value_obs.value'));
                var vlsamplev = new Date(getValue('vlsample_value_obs.value'));


                if (confirmVal > rctd) {
                    getField('recency_test_date.error').html('RecencyTest Date cannot be earlier than Confirmation Test Date').show();
                    return false;
                }

                if (visitVal > testVal) {
                    getField('hiv_test_date.error').html('Screening Test Date cannot be earlier than Visit Date').show();
                    return false;
                }

                if (testVal > confirmVal) {
                    getField('confirm_test_date.error').html('Confirmatory Test Date cannot be earlier than Screening Test Date').show();
                    return false;
                }

                if (confirmVal > tieVal) {
                    getField('tie_test_date.error').html('Tie Breaker Test Date cannot be earlier than Confirmatory Test Date').show();
                    return false;
                }

                if (rctd > vlsamplev) {
                    getField('vlsample_value_obs.error').html('Sample collection date cannot be earlier than Recency Test Date').show();
                    return false;
                }

                if (vlsamplev > vlpcr) {
                    getField('vlpcr_value_obs.error').html('Date Sample Sent to PCR Lab cannot be earlier than Sample collection date').show();
                    return false;
                }

                if (vlpcr > vlvalue) {
                    getField('vl_value_obs.error').html('Sample test date cannot be earlier than Date Sample Sent to PCR Lab').show();
                    return false;
                }

                var vlresultT = getValue('vl_result_clasification.value');
                var vlresultobs = getValue('vl_result_obs.value');
                if (vlresultT == "166239") {
                    if (vlresultobs &lt; 1000) {
                        getField('vl_result_obs.error').html('Result (copies/ml) cannot be less than 1000 if Viral Load Result Classification is greater than 1000').show();
                        return false;
                    }
                }
                if (vlresultT == "166238") {
                    if (vlresultobs > 1000) {
                        getField('vl_result_obs.error').html('Result (copies/ml) cannot be greater than 1000 if Viral Load Result Classification is less than 1000').show();
                        return false;
                    }
                }

                if (confirm("Have you verified the correctness of all fields from the paper form? Are you sure you want to submit?")) {
                    return true;
                } else {
                    return false;
                }

                return true;
            } else {

                var testVal = new Date(getValue('hiv_test_date.value'));
                var rctd = new Date(getValue('recency_test_date.value'));

                if (getField('recency_test_date.error') != null)
                    if(testVal > rctd) {
                        getField('recency_test_date.error').html('RecencyTest Date cannot be earlier than Screening Test Date').show();
                        return false;
                    }

                var confirmVal = new Date(getValue('confirm_test_date.value'));
                var visitVal = new Date(getValue('date_of_visit.value'));

                var tieVal = new Date(getValue('tie_test_date.value'));

                if (visitVal > testVal) {
                    getField('hiv_test_date.error').html('Screening Test Date cannot be earlier than Visit Date').show();
                    return false;
                }

                if (testVal > confirmVal) {
                    getField('confirm_test_date.error').html('Confirmatory Test Date cannot be earlier than Screening Test Date').show();
                    return false;
                }

                if (confirmVal > tieVal) {
                    getField('tie_test_date.error').html('Tie Breaker Test Date cannot be earlier than Confirmatory Test Date').show();
                    return false;
                }
                return true;
            }

            var scntest = getValue('screen_test_value.value');

            if (scntest == "1228") {
                if (test_name_dropdown === "") {
                    getField('test_name_dropdown.error').html('Test Name cannot be empty').show();
                    return false;
                }
                if (recency_test_date === "") {
                    getField('recency_test_date.error').html('Test Date cannot be empty').show();
                    return false;
                }
                if (tb_optout === "") {
                    getField('tb_optout.error').html('Opt Out of RTRI cannot be empty').show();
                    return false;
                }
                return true;
            } else {
                return true;
            }
            if (getField('tb_vl_request.value') != null) {
                getField('tb_vl_request.value').change(function() {
                    var tbvlresult = getValue('tb_vl_request.value');
                    if (tbvlresult == "1066") {} else {
                        if (final_recency_value == "") {
                            getField('final_recency_value.error').html('Final Recency Result cannot be empty').show();
                            return false;
                        }
                    }
                });
            }
        });
    </script>
</htmlform>